atom.declare('atom.Router',{history:[],initialize:function(settings){window.addEventListener('hashchange',this.route.bind(this));this.events=atom.Events(this);this.settings=atom.Settings(this.settings).set(settings).addEvents(this.events);},get current(){return this.history.last;},route:function(){var uri=atom.uri();this.history.push(uri.anchor);this.events.fire(uri.anchor);},navigate:function(name){if(this.current==name){return false;}
var base=window.location.href.split('#')[0];window.location.href=base+'#'+name;},back:function(){this.history.pop()
this.navigate(this.current);}});atom.declare('atom.View',{bindEventsList:'click contextmenu mouseup mousedown mouseover mouseout'.split(' '),initialize:function(settings){this.bindMethods('eventHandler');this.events=atom.Events(this);this.settings=atom.Settings(settings).addEvents(this.events);var el=this.settings.get('el'),extend=this.settings.get('extend');this.el=el&&atom.dom(el);this.bindEvents();if(typeof extend==='object'){atom.core.append(this,extend);}},create:function(){this.el&&this.unbindEvents();this.el=atom.dom.create.apply(atom.dom,arguments);this.bindEvents();return this;},render:function(){return this;},destroy:function(){this.el&&this.unbindEvents()&&this.el.destroy();return this;},eventHandler:function(e){var view=this;var name=e.type;var targetElem=e.target;this.events.fire(name,[e,this]);},bindEvents:function(){return this.changeEventsStatus('bind');},unbindEvents:function(){return this.changeEventsStatus('unbind');},changeEventsStatus:function(action){for(var i=this.bindEventsList.length;i--;){this.el[action](this.bindEventsList[i],this.eventHandler);}
return this;}});atom.declare('atom.Model',{defaults:{},initialize:function(settings){this.events=atom.Events(this);this.settings=atom.Settings(this.defaults).set(settings).addEvents(this.events);},get:function(name){return this.settings.get(name);},set:function(name,value){this.settings.values[name]=value;},has:function(name){return this.get(name)!==null;},get json(){return atom.clone(this.settings.values);}});
